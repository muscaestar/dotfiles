# Minimal Bash config for Ubuntu-first workflow
# Focus: practical defaults, low maintenance, no external framework

# Apply only to interactive shells
case "$-" in
  *i*) ;;
  *) return ;;
esac

# Keep command history useful and deduplicated
HISTSIZE=5000
HISTFILESIZE=10000
HISTCONTROL=ignoredups:erasedups
shopt -s histappend

# Better interactive behavior
set -o vi
shopt -s checkwinsize

# Core environment
export EDITOR=vim
export PAGER=less

# Append path entries only when directory exists and not yet included
append_path() {
  local path_dir="$1"
  if [[ -d "$path_dir" && ":$PATH:" != *":$path_dir:"* ]]; then
    PATH="$PATH:$path_dir"
  fi
}

append_path "$HOME/.local/bin"
append_path "$HOME/bin"
export PATH

# Minimal aliases
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
alias grep='grep --color=auto'

# Minimal helper function
mkcd() {
  mkdir -p "$1" && cd "$1"
}

# Prompt: show current git branch when inside a git repository
__musca_git_branch() {
  local branch_name
  if ! command -v git >/dev/null 2>&1; then
    return 0
  fi

  branch_name="$(git symbolic-ref --short HEAD 2>/dev/null || git rev-parse --short HEAD 2>/dev/null || true)"
  if [[ -n "$branch_name" ]]; then
    printf ' (%s)' "$branch_name"
  fi
}

__musca_prompt_command() {
  local c_reset='\[\e[0m\]'
  local c_user='\[\e[1;32m\]'
  local c_dir='\[\e[1;34m\]'
  local c_git='\[\e[0;36m\]'

  PS1="${c_user}\\u${c_reset}:${c_dir}\\W${c_reset}${c_git}\$(__musca_git_branch)${c_reset}\\$ "
}

if [[ -z "${MUSCA_PROMPT_INITIALIZED:-}" ]]; then
  PROMPT_COMMAND="${PROMPT_COMMAND:+${PROMPT_COMMAND}; }__musca_prompt_command"
  MUSCA_PROMPT_INITIALIZED=1
fi
